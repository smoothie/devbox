---
-   name: Make $host_user root
    user:
        name: "{{ common_user }}"
        groups: sudo
        append: yes
    tags:
        - common_setup

-   name: Add .bash_aliases
    template:
        src: aliases
        dest: "{{ common_bash_aliases_path }}"
    tags:
        - common_setup

-   name: Add custom aliases
    blockinfile:
        path: "{{ common_bash_aliases_path }}"
        block: |-
            {{ common_extra_bash_aliases }}
        marker: "# {mark} Ansible(smoothie.common): Add custom aliases"
    register: custom_alias_changes
    changed_when: custom_alias_changes.changed
    when: >
        common_extra_bash_aliases | default(false)
    tags:
        - common_setup

-   name: Install common packages
    apt:
        name: "{{ common_packages | join(',') }}"
        state: present
    tags:
        - common_setup


-   name: Keep bash_completion when suing
    blockinfile:
        path: /root/.bashrc
        block: |
            if [ -f /etc/bash_completion ] && ! shopt -oq posix; then
                . /etc/bash_completion
            fi
        marker: "# {mark} Ansible(smoothie.common): Keep bash_completion when suing"
    tags:
        - common_setup
